{% extends "base.html" %}
{% block title %}Agendamento #{{ appointment.id }}{% endblock %}

{% block extra_css %}
<style nonce="{{ csp_nonce }}">
  :root { --bg:#0b0f17; --panel:#111827; --muted:#9CA3AF; --text:#F9FAFB; --ring:#93C5FD;
          --a1:#60A5FA; --a2:#34D399; --a3:#F59E0B; --a4:#F87171; }
  @media (prefers-color-scheme: light){
    :root { --bg:#F3F4F6; --panel:#FFFFFF; --muted:#4B5563; --text:#111827; --ring:#2563EB; }
  }
  #apd { color: var(--text); }
  .wrap { max-width: 900px; margin: 0 auto; padding: 1rem; }
  .card { background: var(--panel); border-radius: 1rem; padding: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,.2); border:1px solid #1F2937; }
  .header { display:flex; align-items:center; justify-content:space-between; gap:1rem; }
  .title { font-size:1.25rem; font-weight:700; }
  .subtle { color:var(--muted); }
  .btn { display:inline-flex; align-items:center; gap:.5rem; border:1px solid #374151; padding:.6rem .9rem; border-radius:.75rem; color:var(--text); text-decoration:none; background:transparent; }
  .btn:focus { outline:3px solid var(--ring); outline-offset:2px; }
  .grid { display:grid; gap:1rem; grid-template-columns: 1fr 1fr; }
  .field { display:flex; flex-direction:column; gap:.25rem; }
  .label { font-weight:600; color:var(--muted); }
  .value { font-size:1.05rem; }
  .badge { display:inline-flex; align-items:center; gap:.4rem; font-size:.85rem; border-radius:999px; padding:.25rem .6rem; border:1px solid transparent; }
  .b-conf { background:rgba(52,211,153,.15); color:#34D399; border-color:rgba(52,211,153,.4);}
  .b-canc { background:rgba(248,113,113,.15); color:#F87171; border-color:rgba(248,113,113,.4);}
  .b-done { background:rgba(245,158,11,.15); color:#F59E0B; border-color:rgba(245,158,11,.4);}
  .b-pend { background:rgba(96,165,250,.15); color:#60A5FA; border-color:rgba(96,165,250,.4);}
  .mt-2{ margin-top:.5rem; } .mt-4{ margin-top:1rem; }
  @media (max-width: 800px){ .grid{ grid-template-columns:1fr; } }
</style>
{% endblock %}

{% block content %}
<div id="apd">
  <div class="wrap">

    <header class="card header" aria-labelledby="apd-title">
      <div>
        <h1 id="apd-title" class="title">Agendamento #{{ appointment.id }}</h1>
        <p class="subtle">Status:
          {% if appointment.status_kind == 'confirmado' %}
            <span class="badge b-conf">Confirmado</span>
          {% elif appointment.status_kind == 'cancelado' %}
            <span class="badge b-canc">Cancelado</span>
          {% elif appointment.status_kind == 'realizado' %}
            <span class="badge b-done">Realizado</span>
          {% else %}
            <span class="badge b-pend">Pendente</span>
          {% endif %}
        </p>
      </div>
      <nav>
        <a class="btn" href="{{ back_url }}" aria-label="Voltar para a agenda">← Voltar</a>
      </nav>
    </header>

    <section class="card mt-4" aria-labelledby="info">
      <h2 id="info" class="title" style="font-size:1.1rem">Informações</h2>
      <div class="grid mt-2">
        <div class="field">
          <span class="label">Aluno</span>
          <span class="value">{{ appointment.student_name or ('#' ~ appointment.student_id) }}</span>
        </div>
        <div class="field">
          <span class="label">Serviço</span>
          <span class="value">{{ appointment.service or '—' }}</span>
        </div>
        <div class="field">
          <span class="label">Local</span>
          <span class="value">{{ appointment.location or '—' }}</span>
        </div>
        <div class="field">
          <span class="label">Profissional (ID)</span>
          <span class="value">#{{ appointment.professional_id }}</span>
        </div>
        <div class="field">
          <span class="label">Início</span>
          <span class="value">{{ appointment.starts_at_str }}</span>
        </div>
        <div class="field">
          <span class="label">Fim</span>
          <span class="value">{{ appointment.ends_at_str }}</span>
        </div>
        <div class="field">
          <span class="label">Duração</span>
          <span class="value">{{ appointment.duration_min if appointment.duration_min is not none else '—' }}{% if appointment.duration_min is not none %} min{% endif %}</span>
        </div>
        <div class="field">
          <span class="label">Criado / Atualizado</span>
          <span class="value">{{ appointment.created_at or '—' }} · {{ appointment.updated_at or '—' }}</span>
        </div>
      </div>
    </section>

    {% if appointment.raw_status %}
    <section class="card mt-4" aria-labelledby="raw">
      <h2 id="raw" class="title" style="font-size:1.1rem">Status bruto</h2>
      <p class="subtle">{{ appointment.raw_status }}</p>
    </section>
    {% endif %}

    {% if appointment.notes %}
    <section class="card mt-4" aria-labelledby="notes">
      <h2 id="notes" class="title" style="font-size:1.1rem">Observações</h2>
      <p>{{ appointment.notes }}</p>
    </section>
    {% endif %}

  </div>
</div>
{% endblock %}
