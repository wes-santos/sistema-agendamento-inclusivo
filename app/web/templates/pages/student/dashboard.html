{% extends "_base/base.html" %}
{% set body_class = 'page-student page-student-dashboard' %}

{% from "components/card.html" import card %}
{% from "components/badge.html" import status_badge %}

{% block title %}Meu painel — Estudante{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/20-pages/family.css') }}?v={{ app_version|default('1') }}">
{% endblock %}

{% block content %}
{% set breadcrumbs = breadcrumbs if breadcrumbs is defined else trail or [
    {'label': 'Início', 'href': '/'},
    {'label': 'Meu painel'}
] %}
{% include "_partials/breadcrumbs.html" %}

<div class="grid-2">
  {% call card(title="Olá, {{ current_user.name }}", subtitle="Acompanhe seus próximos atendimentos") %}
    <p>Responsável: <strong>{{ student.guardian.name if student.guardian else '—' }}</strong></p>
    <p>E-mail de acesso: <strong>{{ current_user.email }}</strong></p>
  {% endcall %}

  {% call card(title="Próximos atendimentos") %}
    {% if upcoming %}
      <div class="table-wrap table-wrap--responsive">
        <table class="table table--striped table--hover">
          <thead class="table__head">
            <tr>
              <th class="table__th">Serviço</th>
              <th class="table__th">Profissional</th>
              <th class="table__th is-right">Início</th>
              <th class="table__th is-right">Fim</th>
              <th class="table__th">Status</th>
            </tr>
          </thead>
          <tbody class="table__body">
            {% for ap in upcoming %}
            <tr class="table__row">
              <td class="table__td">{{ ap.service or '—' }}</td>
              <td class="table__td">{{ ap.professional or '—' }}</td>
              <td class="table__td is-right nowrap">{{ ap.starts_at }}</td>
              <td class="table__td is-right nowrap">{{ ap.ends_at }}</td>
              <td class="table__td">{{ status_badge(ap.status) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p>Nenhum atendimento futuro encontrado.</p>
    {% endif %}
  {% endcall %}
</div>
{% endblock %}
